---
layout: default
title:  签到管理
---


---

#需求描述:
    导师这边需要做一个教室管理系统,其中包含签到部分.
1. 如何签到:每个教室有个摄像头,**开始上课**后启动定时拍照,学生从照片中抠图抠出自己头像.
2. 首次抠图后系统记录下学生所在位置,以后每次自动从该位置抠出学生个人图片.支持位置重新配置.
3. 如果出现意外(比如定时拍照时学生出去上厕所等情况),支持一定时间范围内学生主动重新申请拍照抠图.
4. 下课后,该教室摄像头不再定时拍照.
5. 拍照抓图的图片存储到服务器文件系统中,并将抓图时间/教室/存储路径等信息存储到数据库中

#对于后台来说:

大致想法是这样做,一个daemon进程作为守护进程

一个request可执行文件,接收web端请求,并通过消息队列发送给daemon
    添加一节课到课表中
    重新从数据库导入课表(初始化)
    
另一个即时抓图程序capture执行单次抓图

##web端请求(数据库的操作都由web做,除了初始化从数据库读入课程)
1. 初始化定时任务                               class_init
2. 添加定时任务                                 add 编号 星期几 课程开始时间 教室 课程名 开始周数 结束周数 学期开始日期
3. 删除定时任务                                 del 编号(crontab)
4. 清空定时任务                                 clean(crontab)     
5. 主动单次抓图                                 capture 教室 课程名
6. 例外情况,例如临时添加课程,临时不上课         
7. 任务有优先级

##定时任务
1. 结合crontab.
2. 具体某节课,在crontab中添加课程开始和课程结束
3. 课程开始,crontab发送一个消息A,在daemon进程中启动程序定时,每5分钟进行一次单次抓图.
4. 课程结束,crontab发送一个消息B,在daemon进程中取消该课程的定时.

##单次抓图(capture进程)
1. 如果是crontab定时器, 抓图后存储图片到本地,发送路径/时刻/教室等信息给web端,若失败发送时刻/教室/错误码给web端,成功或失败均记入log日志
2. 如果是web主动请求, 抓图后存储图片到本地,发送路径/时刻/教室等信息给web端,若失败发送时刻/教室/错误码给web端,成功或失败均记入log日志

##daemon进程
1. 请求处理(消息队列)
2. 定时任务的增删改查
3. 优先级如何处理

